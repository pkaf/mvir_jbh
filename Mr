{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "####First, let's define some terms related to NFW (Navarro 1996) density profile.####"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#A. Formulary#"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "####NFW density####"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "\\begin{equation}\n",
    "\\rho(r) = \\frac{\\rho_s}{x(1+x)^2}, \\mathsf{where}\\ x = r/r_s. .........(1)\n",
    "\\end{equation}\n"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "####Mass profile corresponding to Equation 1####"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "\\begin{equation}\n",
    "M(<r) = 4 \\pi \\rho_s r_s^3 \\left[ \\ln(1+x) - \\frac{x}{1+x} \\right]......... (2)\n",
    "\\end{equation}"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "####Virial mass#### "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Virial mass, $M_\\text{vir}$, is defined as the mass within some distance distance $r_\\text{vir}$ where the density is some threshold overdensity ($\\Delta_\\text{th}$, conventionally chosen to be 200) times the critical density $\\rho_c$ given by "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "\\begin{equation}\n",
    "M_{\\mathsf{vir}} = \\frac{4}{3} \\pi (\\Delta_{\\mathsf{th}} \\rho_c) r_{\\mathsf{vir}}^3, ............(3) \n",
    "\\end{equation}"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Here, critical density $\\rho_c$ is given by,"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "\\begin{equation}\n",
    "\\rho_c = \\frac{3\\text{H}^2}{8 \\pi \\text{G}}, \\ \\text{where G and H are Gravitational and Hubble constants respectively}.  \n",
    "\\end{equation}"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "For $r=r_{\\mathsf{vir}}$ in equation 2 we obtain $M_\\mathsf{vir}$. Now, substituting the value of $M_\\mathsf{vir}$ in equation 3 we get the expression for the density normalisation: "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "\\begin{equation}\n",
    "\\rho_s = \\rho_c \\frac{\\Delta_\\mathsf{th}}{3} \\frac{c^3}{\\ln(1+c) - \\frac{c}{1+c}}, \\mathsf{where}\\ c = r_{\\mathsf{vir}}/r_s...............(4)\n",
    "\\end{equation}"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now we use above equations 2, 3 and 4 to convert cumulative mass $M(<r)$ generally reported in the \n",
    "literature to the required $M_\\mathsf{vir}$. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#B. $M(<r)$ to $M_\\mathsf{vir}$#"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "For some **assumed value of concentration** ($c = r_\\mathsf{vir}/r_s$) and given **$\\Delta_\\mathsf{th}$** and **$\\rho_c$** one can compute $\\rho_s$ from Equation 4. Alongwith the measured value of $\\rho_s$ and the cumulative mass $M(<r)$ given in the literature one can solve Equation 2 for $r_s$. With $r_s$ and $c$ one can compute $r_\\mathsf{vir}$. Finally, we use Equation 3 to compute $M_\\mathsf{vir}$."
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#C. $M_{200}$, $c_{200}$ to $M_{\\mathsf{any} \\Delta'}$, $c_{\\mathsf{any} \\Delta'}$#"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "In order to compute mass and concentration values for some arbitrary density threshold (say $\\Delta' = \\Omega_m \\times 340$ ref. Bryan and Norman 1998) from mass-concentration pair with given $\\Delta_\\mathsf{th}$ (say 200) we perform following mathematical kungfu. First, substitute $M_{200}$, $\\Delta_\\mathsf{th}=200$ and $\\rho_c$ in Equation 3 to measure $r_{200}$, which with known $c_{200}(=r_{200}/r_s)$ gives $r_s$. Now, solve Equation 3 and Equation 2 for $r_{\\Delta'}$, which is the trickier part. Finally, with $r_{\\Delta'}$ one can compute $M_{\\Delta'}$ from equation 3 and also, $c_{\\Delta'}$ ($=r_{\\Delta'}/r_s$).  "
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 2",
   "language": "python",
   "name": "python2"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 2
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython2",
   "version": "2.7.9"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}
